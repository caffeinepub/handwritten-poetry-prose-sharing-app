{
  "kind": "coverage_report",
  "version": "1.0",
  "generatedAt": "2026-02-05T10:57:57.998Z",
  "sources": {
    "buildRequest": true,
    "implementationPlan": true
  },
  "requirements": {
    "total": 3,
    "implemented": 2,
    "items": [
      {
        "id": "REQ-1",
        "summary": "Update the backend subscription logic so that subscription status is based on successful Stripe checkout verification rather than the caller’s authenticated role.\n\n- Track per-principal subscription activation in backend state (e.g., a map keyed by Principal).\n- When `getStripeSessionStatus(sessionId)` is called and the session is verified as successfully completed/paid, mark the owning principal as subscribed (idempotently).\n- Update `isUserSubscribed()` to return the stored Stripe-backed subscription state for the caller (defaulting to false when no active subscription is recorded).\n- Preserve existing authorization checks so only the session owner (or an admin) can verify a session.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-2",
        "summary": "Improve the Pricing page post-checkout confirmation UX to make verification explicit, resilient, and user-friendly.\n\n- On redirect back to `/pricing?success=true&session_id=...`, show a clear in-page “Verifying your subscription…” state (disable plan buttons while verifying).\n- Automatically verify the session via `useVerifyCheckoutSession`.\n- If verification fails with a transient error, provide a visible “Try again” action and keep the `session_id` available until verification succeeds or the user dismisses the flow.\n- Ensure URL parameters used for return handling are cleaned up appropriately to avoid repeated toasts/verification on refresh (including handling `canceled=true`).",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/utils/urlParams.ts",
          "frontend/src/pages/PricingPage.tsx"
        ],
        "matchedFiles": [
          "frontend/src/utils/urlParams.ts",
          "frontend/src/pages/PricingPage.tsx"
        ]
      },
      {
        "id": "REQ-3",
        "summary": "Reflect verified subscription status in the Pricing UI.\n\n- After successful verification, refresh and display the user’s current subscription status using the existing React Query subscription status query.\n- If the user is subscribed, indicate that in the Pricing page and prevent initiating a new checkout session from the plan buttons (or clearly label the buttons as unavailable).",
        "status": "implemented",
        "plannedFiles": [
          "frontend/src/hooks/useQueries.ts",
          "frontend/src/pages/PricingPage.tsx"
        ],
        "matchedFiles": [
          "frontend/src/hooks/useQueries.ts",
          "frontend/src/pages/PricingPage.tsx"
        ]
      }
    ]
  },
  "changedFiles": [
    "backend/main.mo",
    "backend/migration.mo",
    "build-request.json",
    "feature_evidence.json",
    "frontend-file-summaries.txt",
    "frontend-implementation-plan.json",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/pages/PricingPage.tsx",
    "frontend/src/utils/urlParams.ts",
    "project_state.json",
    "scratch/component-selection.json",
    "spec.md",
    "spec_vs_diff_report.json"
  ]
}